(function(ak){var aK=document.documentElement,X=Ext.each,Y=Ext.isEmpty,y=false,V=true,ah=null,W="_",e="__",f="-",l=".",i=" ",m="",q="]",aj="-c",ac="-u",a="td",aH="tr",aa="none",b="left",w="display",d="outline",ay="1px dotted blue",p="recordid",S="row-selected",G="required",I="dataindex",ap="item-notBlank",ad="item-invalid",c="table-row-alt",E="table-rowbox",r=l+E,ar="table.rowcheck",av="table.rowradio",ai="table-ckb ",au="table-select-all",Z="multiple",ag="checkedvalue",n="-readonly",ax="desc",g="asc",aA="table-desc",O="table-asc",u="item-ckb",M=u+"-self",aJ=l+M,ao=u+ac,aw=u+aj,B=u+n+ac,L=u+n+aj,N="item-radio-img",aC=N+aj,at=N+ac,J=N+n+aj,t=N+n+ac,aG=aJ+i+l+aw,aD="table-cell",al=aD+"-editor",D="cellcheck",P="rowcheck",Q="rowradio",h="click",z="cellclick",k="render",aF="rowclick",ae="editorshow",K="nexteditorshow",aB="keydown",ab="select",o="mousedown",az="resize",R="未找到",aq="方法!",F="tr[class!=grid-hl]",j="div[atype=table.headcheck]",T="td[dataindex=",aI="grid-ckb ",H=function(C,U,aN,aM){if(U.length){var aL=[],A=[],aO=U.shift();if(Ext.isDefined(aN)){aL.value=aN;aL.colname=aM}X(C,function(aR){var aP=aR.get(aO);var aQ=x(A,aP);if(!aQ){A.push(aQ=[]);if(Y(aP)){aQ.value=v(aR,aO)}else{aQ.value=aP}aQ.colname=aO}aQ.push(aR)});X(A,function(aQ,aP){aL.push(H(aQ,[].concat(U),aQ.value,aQ.colname))});return aL}else{return C}},an=function(A){var C=[];X(A,function(U){if(Ext.isArray(U)){C=C.concat(an(U))}else{C.push(U)}});return C},x=function(A,C){var U=null;X(A,function(aL){if(aL.value==C){U=aL;return y}});return U},af=function(A,C){var U=null;X(A,function(aL){if(aL.value==C||aL.value&&(aL=af(aL,C))){U=aL;return y}});return U},aE=function(A,C){var U=null;X(A,function(aL){if(aL.value?aE(aL,C):aL===C){U=aL;return y}});return U},am=function(C,U,A){X(C,function(aL){if(Ext.isArray(aL)){am(aL,U,C)}else{C.remove(U);return y}});if(C&&!C.length&&A){A.remove(C)}},s=function(){function A(C,U,aM){var aO=y,aL=aM.shift(),aN;if(!aL){return U}aN=U.get(aL);if(Y(aN)){aN=v(U,aL)}else{X(C,function(aP){if(Ext.isArray(aP)){if(aN==aP.value){aO=aP;return y}}})}if(!aO&&aL){aO=[];aO.colname=aL;aO.value=aN}aO.add(A(aO,U,aM));return aO}return function(C,U,aM){var aL=[];Ext.each(aM,function(aN){if(aN.group){aL.push(aN.name)}});C.add(A(C,U,aL));X(an(aE(C,U)),function(aN){if(aN!==U){var aO=aN.ds;aO[aN.isSelected?"select":"unSelect"](U);return y}})}}(),v=function(A,C){return"____empty__group__"+A.id+"__"+C+"___"};ak.Table=Ext.extend(ak.Component,{initComponent:function(A){ak.Table.superclass.initComponent.call(this,A);var U=this,C=U.wrap;U.th=C.child("thead tr.table-head");U.tbody=C.child(">tbody");U.fb=C.child("tfoot");U.initTemplate()},processListener:function(A){var C=this;ak.Table.superclass.processListener.call(C,A);C.tbody[A](h,C.onClick,C);C.wrap[A]("focus",C.onFocus,C)[A]("blur",C.onBlur,C)[A](Ext.isOpera?"keypress":aB,C.handleKeyUp,C)[A]("keyup",C.handleKeyUp,C)[A](o,C.onMouseDown,C);if(C.canwheel){C.tbody[A]("mousewheel",C.onMouseWheel,C)}if(C.th){C.th[A](h,C.onHeadClick,C)}C[A](z,C.onCellClick,C)},processDataSetLiestener:function(A){var C=this,U=C.dataset;if(U){U[A]("ajaxfailed",C.onAjaxFailed,C);U[A]("metachange",C.onLoad,C);U[A]("update",C.onUpdate,C);U[A]("reject",C.onUpdate,C);U[A]("add",C.onAdd,C);U[A]("submit",C.onBeforSubmit,C);U[A]("submitfailed",C.onAfterSuccess,C);U[A]("submitsuccess",C.onAfterSuccess,C);U[A]("query",C.onBeforeLoad,C);U[A]("load",C.onLoad,C);U[A]("loadfailed",C.onAjaxFailed,C);U[A]("valid",C.onValid,C);U[A]("beforeremove",C.onBeforeRemove,C);U[A]("remove",C.onLoad,C);U[A]("clear",C.onLoad,C);U[A]("refresh",C.onLoad,C);U[A]("fieldchange",C.onFieldChange,C);U[A]("indexchange",C.onIndexChange,C);U[A]("select",C.onSelect,C);U[A]("unselect",C.onUnSelect,C);U[A]("selectall",C.onSelectAll,C);U[A]("unselectall",C.onUnSelectAll,C)}},initEvents:function(){ak.Table.superclass.initEvents.call(this);this.addEvents(k,z,aF,ae,K)},bind:function(A){if(Ext.isString(A)){A=$(A);if(!A){return}}this.dataset=A;this.processDataSetLiestener("on");this.onLoad()},handleKeyUp:function(A){if(A.getKey()==9){this.showEditorByRecord()}},initTemplate:function(){this.cellTpl=new Ext.Template(['<div style="width:{width}" class="',aD,' {cellcls}" id="',this.id,"_{name}_{",p,'}">{text}</div>']);this.cbTpl=new Ext.Template(['<center><div class="{cellcls}" id="',this.id,"_{name}_{",p,'}"></div></center>'])},createRow:function(aL,aQ,aN,aU,U){var aP=this;if(Ext.isArray(aL)){X(aL,function(aX,aV,aW){if(aW=aX.colname){aU=aU||{};aU[aW]=an(aX).length;aU[aW+"_count"]=V}return aP.createRow(aX,aQ,aN,aU,!aV)})}else{var aR=aP.tbody.dom.insertRow(-1),aS=ah,aT=y,aM=aP.parseCss(aP.renderRow(aL,aQ));aR.id=aP.id+f+aL.id;aR.style.cssText=aM.style;Ext.fly(aR).addClass((aQ%2==1?c+i:m)+aM.cls).set({_row:aL.id});X(aP.columns,function(aV){if(aV.hidden&&aV.visiable==y){return}var aW,aX=aV.type;if(aP.isFunctionCol(aX)){aW="__rowbox__"}else{aW=aV.name}aS=aU&&aU[aW];if(!aS||aU[aW+"_count"]){aP.createCell(aR,aV,aL,aS)}if(aU&&aU[aW+"_count"]){aU[aW+"_count"]=y}});if(aN){var aO=aP.wrap.query("tbody tr");for(var C=aQ+1,A=aO.length;C<A;C++){Ext.fly(aO[C]).toggleClass(c).select(r).each(function(aV){aP.setSelectStatus(aP.dataset.findById(aV.getAttributeNS(m,p)))})}}}},createEmptyRow:function(){var A=this;A.emptyRow=A.tbody.dom.insertRow(-1);X(A.columns,function(C){Ext.fly(A.emptyRow.insertCell(-1)).set({atype:aD,dataindex:C.name}).setStyle({"text-align":C.align||b,display:C.hidden?aa:m}).update("&#160;")})},removeEmptyRow:function(){var A=this;if(A.emptyRow){A.tbody.dom.removeChild(A.emptyRow);A.emptyRow=ah}},getCheckBoxStatus:function(A,aL,U){var aN=this.dataset.getField(aL),C=aN.getPropertity(ag),aM=A.data[aL];return u+(U?n:m)+((aM&&aM==C)?aj:ac)},createCell:function(aS,A,aN,aL){var aO=this,aP=aO.getEditor(A,aN),C=A.type,aR=A.name,aM,aU=m,U;if(aS.tagName.toLowerCase()=="tr"){U=aS.insertCell(-1)}else{U=Ext.fly(aS).parent(a).dom}if(aP!=m){var aQ=ak.CmpManager.get(aP);if(aQ&&(aQ instanceof ak.CheckBox)){C=D}else{aU=al}}else{if(aR&&Ext.isDefined(aN.getField(aR).get(ag))){C=D;aM=V}}if(aO.isFunctionCol(C)){aM=aO.dataset.execSelectFunction(aN)?m:n;Ext.fly(U).set({atype:C==P?ar:av,recordid:aN.id}).addClass(E);U.innerHTML=aO.cbTpl.applyTemplate({cellcls:C==P?ai+u+aM+ac:"table-radio "+N+aM+ac,name:aR,recordid:aN.id})}else{Ext.fly(U).set({atype:aD,recordid:aN.id,dataindex:aR}).setStyle({"text-align":A.align||b,display:A.hidden?aa:m});if(C==D){U.innerHTML=aO.cbTpl.applyTemplate({cellcls:ai+aO.getCheckBoxStatus(aN,aR,aM),name:aR,recordid:aN.id})}else{var aT=aN.getMeta().getField(aR);if(aT&&Y(aN.data[aR])&&aN.isNew==V&&aT.get(G)==V){aU=aU+i+ap}U.innerHTML=aO.cellTpl.applyTemplate({text:aO.renderText(aN,A,aN.data[aR]),cellcls:aU,name:aR,recordid:aN.id,width:A.width+"px"})}}if(aL){U.rowSpan=aL}},onSelect:function(aL,C,aM){if(!C||aM){return}var U=this,A=Ext.get(U.id+e+C.id);if(A){A.parent(r).addClass(M);if(U.selectionmodel==Z){U.setCheckBoxStatus(A,V)}else{U.setRadioStatus(A,V);aL.locate((aL.currentPage-1)*aL.pagesize+aL.indexOf(C)+1)}U.setSelectStatus(C)}U.groupselect&&X(!aM&&an(aE(U.groups,C)),function(aN){if(aN!==C){aL.select(aN)}})},onUnSelect:function(aL,C,aM){if(!C||aM){return}var U=this,A=Ext.get(U.id+e+C.id);if(A){A.parent(r).addClass(M);if(U.selectionmodel==Z){U.setCheckBoxStatus(A,y)}else{U.setRadioStatus(A,y)}U.setSelectStatus(C)}U.groupselect&&X(!aM&&an(aE(U.groups,C)),function(aN){if(aN!==C){aL.unSelect(aN)}})},onSelectAll:function(){var A=this;A.clearChecked();A.isSelectAll=V;A.isUnSelectAll=y;A.wrap.addClass(au)},onUnSelectAll:function(){var A=this;A.clearChecked();A.isSelectAll=y;A.isUnSelectAll=V;A.wrap.removeClass(au)},clearChecked:function(){var A=this.wrap;A.select(aG).replaceClass(aw,ao);A.select(aJ).removeClass(M)},setRadioStatus:function(A,C){if(!C){A.removeClass(aC).addClass(at)}else{A.addClass(aC).removeClass(at)}},setCheckBoxStatus:function(A,C){if(!C){A.removeClass(aw).addClass(ao)}else{A.addClass(aw).removeClass(ao)}},setSelectDisable:function(U,C){var A=this.dataset.selected.indexOf(C)==-1;if(this.selectionmodel==Z){U.removeClass([aw,ao]).addClass(A?B:L)}else{U.removeClass([aC,at,J,t]).addClass(A?t:J)}},setSelectEnable:function(U,C){var A=this.dataset.selected.indexOf(C)==-1;if(this.selectionmodel==Z){U.removeClass([B,L]).addClass(A?ao:aw)}else{U.removeClass([at,aC,t,J]).addClass(A?at:aC)}},setSelectStatus:function(C){var U=this,aL=U.dataset;if(aL.selectfunction){var A=Ext.get(U.id+e+C.id);if(!aL.execSelectFunction(C)){U.setSelectDisable(A,C)}else{U.setSelectEnable(A,C)}}},onHeadClick:function(aP,U){var aN=this,aO=aN.dataset;U=Ext.get(U);if(U.is(j)){var aM=U.hasClass(aw);aN.setCheckBoxStatus(U,!aM);if(!aM){aO.selectAll()}else{aO.unSelectAll()}}else{if(U.is(".table-hc")){var C=U.getAttributeNS(m,I),A=aN.findColByName(C);if(A&&A.sortable===V){if(aO.isModified()){ak.showInfoMessage("提示","有未保存数据!");return}var aL=m;if(aN.currentSortTarget){aN.currentSortTarget.removeClass([O,aA])}aN.currentSortTarget=U;if(Y(A.sorttype)){A.sorttype=ax;U.removeClass(O).addClass(aA);aL=ax}else{if(A.sorttype==ax){A.sorttype=g;U.removeClass(aA).addClass(O);aL=g}else{A.sorttype=m;U.removeClass([aA,O])}}aO.sort(C,aL)}}}},setEditor:function(C,U){var aL=this,A=aL.findColByName(C),aM=Ext.get([aL.id,C,aL.selectedId].join(W));A.editor=U;if(aM){aL.focusdiv=aM;if(U==m){aM.removeClass(al)}else{if(!$(U) instanceof ak.CheckBox){aM.addClass(al)}}}},getEditor:function(aL,C){var U=aL.editor||m;if(aL.editorfunction){var A=window[aL.editorfunction];if(A==ah){alert(R+aL.editorfunction+aq);return ah}U=A.call(window,C,aL.name)||m}return U},showEditor:function(aQ,A,aP){if(aQ==-1){return}var aN=this,U=aN.findColByName(A);if(!U){return}var C=aN.dataset,aL=C.getAt(aQ);if(!aL){return}if(aL.id!=aN.selectedId){aN.selectRow(aQ)}var aO=aN.getEditor(U,aL);aN.setEditor(A,aO);if(aO!=m){var aM=$(aO);(function(){var aT=aL.get(A),aY=Ext.get([aN.id,A,aL.id].join(W)),aX=aY.getXY(),aS;aM.bind(C,A);aM.render(aL);aM.el.on(aB,aN.onEditorKeyDown,aN);Ext.fly(aK).on(o,aN.onEditorBlur,aN);aS=aN.currentEditor={record:aL,ov:aT,name:A,editor:aM};aN.positionEditor();if(aM instanceof ak.CheckBox){var aR=aN._begin;if(aR){var aW=C.indexOf(aR),aV=C.indexOf(aL);if(aW>aV){var aU=aV;aV=aW;aW=aU}aV++;for(;aW<aV;aW++){C.getAt(aW).set(A,aR.get(A))}delete aN._begin}else{if(aP){aM.focus()}else{aM.onClick()}}}else{if(aM instanceof ak.Field&&!aM instanceof ak.TextArea){aM.el.setStyle("text-align",U.align||b)}else{if(aM instanceof ak.Lov){aM.on("fetching",aN.onFetching,aN)}}aM.isEditor=V;aM.isFireEvent=V;aM.isHidden=y;aM.focus();if(aM.wrap&&!aM.wrap.hasClass("grid-editor")){aM.wrap.addClass("grid-editor")}aM.on(ab,aN.onEditorSelect,aN);if(Ext.isFunction(aP)){aP(aM)}aN.fireEvent(ae,aN,aM,aQ,A,aL)}aN.editing=V;Ext.fly(window).on(az,aN.positionEditor,aN)}).defer(10)}},showEditorByRecord:function(A){var C=this,U=C.dataset,aL=A?U.indexOf(A):0;A=A||U.getAt(0);X(C.columns,function(aM){if(aM.hidden!=V&&C.getEditor(aM,A)!=m){C.fireEvent(z,C,aL,aM.name,A,function(){});C.fireEvent(aF,C,aL,A);return y}})},onEditorSelect:function(){(function(){this.hideEditor()}).defer(1,this)},onEditorKeyDown:function(aM,C){var U=this,aL=aM.keyCode;ced=U.currentEditor;if(aL==27){if(ced){var A=ced.editor;if(A){A.clearInvalid();A.render(A.binder.ds.getCurrentRecord())}}U.hideEditor()}else{if(aL==13){if(!(ced&&ced.editor&&ced.editor instanceof ak.TextArea)){U.showEditorBy(39)}}else{if(aL==9){aM.stopEvent();U.showEditorBy(aM.shiftKey?37:39)}else{if(aM.ctrlKey&&(aL==37||aL==38||aL==39||aL==40)){U.showEditorBy(aL);aM.stopEvent()}}}}},findEditorBy:function(aO){var aR=this,C,aQ;if((C=aR.currentEditor)&&(aQ=C.editor)){var aU=aR.columns,aS=y,aN=aR.dataset,aM=aQ.binder.name,A=aQ.record,aW=aN.data.indexOf(A),U=ah,aT=y,aP=V,aV=y,aL;if(aW!=-1){if(aO==37||aO==38){aU=[].concat(aU).reverse();aP=y}if(aO==38||aO==40){aV=V;aL=aR.findColByName(aM)}while(A){if(!aV){X(aU,function(aX){if(aS){if(aX.hidden!=V&&aR.getEditor(aX,A)!=m){U=aX.name;return y}}else{if(aX.name==aM){aS=V}}})}if(U){return{row:aW,name:U,record:A}}A=aN.getAt(aP?++aW:--aW);if(aP&&!A&&!aT&&aR.autoappend!==y){aR.hideEditor();aN.create();A=aN.getAt(aW);aT=V}if(aV&&A&&aR.getEditor(aL,A)!=m){U=aM}}}}return ah},showEditorBy:function(U){var aL=this,aN=V,C=aL.findEditorBy(U);if(C){aL.hideEditor();var aM=C.row,A=C.record;aL.fireEvent(z,aL,aM,C.name,A,aN);aL.fireEvent(aF,aL,aM,A)}},positionEditor:function(){var C=this,A=C.currentEditor.editor,aL=C.focusdiv,U=aL.getXY();if(A instanceof ak.CheckBox){A.move(U[0],U[1]-3)}else{A.setHeight(aL.getHeight()-2);A.setWidth(aL.getWidth()-5<22?22:(aL.getWidth()-5));A.move(U[0],U[1])}if(A.isExpanded&&A.isExpanded()){if(Ext.isIE){if(C.t){clearTimeout(C.t)}C.t=(function(){A.syncPopup()}).defer(1)}else{A.syncPopup()}}},hideEditor:function(){var aL=this,U=aL.currentEditor;if(U){var C=U.editor;if(C){if(!C.canHide||C.canHide()){C.el.un(aB,aL.onEditorKeyDown,aL);C.un(ab,aL.onEditorSelect,aL);Ext.fly(aK).un(o,aL.onEditorBlur,aL);Ext.fly(window).un(az,aL.positionEditor,aL);C.move(-10000,-10000);var A=C.autocompleteview;if(A){A.hide()}C.blur();C.onBlur();C.isFireEvent=y;C.isHidden=V;aL.editing=y;if(C.collapse){C.collapse()}}}}},selectRow:function(aO,U){var aM=this,aN=aM.dataset,A=aN.getAt(aO),aL=(aN.currentPage-1)*aN.pagesize+aO+1,C=an(aE(aM.groups,A));aM.selectedId=A.id;if(aM.selectTr){aM.selectTr.removeClass(S)}aM.selectTr=aM.tbody.select(C.map(function(aP){return"#"+aM.id+f+aP.id}).join(","));if(aM.selectTr){aM.selectTr.addClass(S)}if(U!==y&&aL!=ah){aN.locate.defer(5,aN,[aL,y])}},drawFootBar:function(C){var A=this;if(!A.fb){return}X([].concat((C)?C:A.columns),function(aO){var aM=Ext.isString(aO)?A.findColByName(aO):aO;if(aM&&aM.footerrenderer){var aN=ak.getRenderer(aM.footerrenderer);if(aN==ah){alert(R+aM.footerrenderer+aq);return}var aL=aM.name,U=aN.call(window,A.dataset.data,aL);if(!Y(U)){A.fb.child(T+aL+q).update(U)}}})},showColumn:function(C){var A=this.findColByName(C);if(A){if(A.hidden===V){delete A.hidden;this.wrap.select(T+C+q).setStyle(w,m)}}},hideColumn:function(C){var A=this.findColByName(C);if(A){if(A.hidden!==V){this.wrap.select(T+C+q).setStyle(w,aa);A.hidden=V}}},findColByName:function(A){var C;if(A){X(this.columns,function(U){if(U.name&&U.name.toLowerCase()===A.toLowerCase()){C=U;return y}})}return C},parseCss:function(U){var aM=m,A=m;if(Ext.isArray(U)){for(var C=0;C<U.length;C++){var aL=this.parseCss(U[C]);aM+=";"+aL.style;A+=i+aL.cls}}else{if(Ext.isString(U)){var aN=!!U.match(/^([^,:;]+:[^:;]+;)*[^,:;]+:[^:;]+;*$/);A=aN?m:U;aM=aN?U:m}}return{style:aM,cls:A}},renderText:function(A,C,aM){var aL=C.renderer;if(aL){var U=ak.getRenderer(aL);if(U==ah){alert(R+aL+aq);return aM}aM=U.call(window,aM,A,C.name)}return Y(aM)?"&#160;":aM},renderRow:function(A,aM){var aL=this.rowrenderer,C=ah;if(aL){var U=ak.getRenderer(aL);if(U==ah){alert(R+aL+aq);return C}C=U.call(window,A,aM);return !C?m:C}return C},renderEditor:function(aL,A,U,C){this.createCell(aL.dom,U,A)},onClick:function(aP,aS){var aO=this,A=(aS=Ext.fly(aS)).dom.tagName.toLowerCase()==a,aQ=A?aS:aS.parent(a);if(aQ){var aL=aQ.getAttributeNS(m,"atype"),aR=aQ.getAttributeNS(m,p),U=aO.dataset;if(aL==aD){var aN=U.findById(aR),aT=U.indexOf(aN),C=aQ.getAttributeNS(m,I);aO.fireEvent(z,aO,aT,C,aN,!aS.hasClass("table-ckb"));aO.fireEvent(aF,aO,aT,aN)}else{if(aL==ar){var aM=Ext.get(aO.id+e+aR);if(aM.hasClass(B)||aM.hasClass(L)){return}if(aO.isSelectAll&&!aM.parent(aJ)){aM.replaceClass(ao,aw)}else{if(aO.isUnselectAll&&!aM.parent(aJ)){aM.replaceClass(aw,ao)}}aM.hasClass(aw)?U.unSelect(aR):U.select(aR)}else{if(aL==av){var aM=Ext.get(aO.id+e+aR);if(aM.hasClass(t)||aM.hasClass(J)){return}U.select(aR)}}}}},onCellClick:function(U,aL,C,A,aM){this.showEditor(aL,C,aM)},onUpdate:function(U,aM,C,aS,aL){var aP=this,aQ=aP.findColByName(C),A,aR;if(aQ&&aQ.group){aM.data[C]=aL;var aO=aP.tbody.query(F).indexOf(aP.tbody.child("tr[_row="+aM.id+"]").dom);aP.onRemove(U,aM);aM.data[C]=aS;aP.onAdd(U,aM,aO,y);!Y(aL)&&X(an(af(aP.groups,aL)),function(aT){if(aT!==aM){aT.set(C,aS)}});aP.selectRow(aP.dataset.indexOf(aM))}if(A=Ext.get([aP.id,C,aM.id].join(W))){var aQ=aP.findColByName(C),aN=aP.getEditor(aQ,aM);if(aN!=m&&($(aN) instanceof ak.CheckBox)){aP.renderEditor(A,aM,aQ,aN)}else{A.update(aP.renderText(aM,aQ,aS))}}X(aP.columns,function(aT){if(aT.name!=C&&(aR=Ext.get([aP.id,aT.name,aM.id].join(W)))){if(aT.editorfunction){aP.renderEditor(aR,aM,aT,aP.getEditor(aT,aM))}if(aT.renderer){aR.update(aP.renderText(aM,aT,aM.get(aT.name)))}}});aP.setSelectStatus(aM);aP.drawFootBar(C)},onLoad:function(){var aL=this,U=aL.wrap,aM=aL.dataset.data,A=U.removeClass(au).child(j);aL.clearBody();aL.processGroups();if(A&&aL.selectable&&aL.selectionmodel==Z){aL.setCheckBoxStatus(A,y)}var C=aM.length;if(C==0){aL.createEmptyRow()}else{aL.renderArea()}aL.drawFootBar();ak.Masker.unmask(U);aL.fireEvent(k,aL)},processGroups:function(){var C=this,U=C.dataset,A=[];C.groups=[].concat(U.getAll());Ext.each(C.columns,function(aL){aL.group&&A.push(aL.name)});if(A.length){an(C.groups=H(C.groups,A))}},renderArea:function(){var A=this;X(A.groups,function(aL,C){var U;if(aL.colname){U={};U[aL.colname]=an(aL).length;U[aL.colname+"_count"]=V;if(A.groupselect){U.__rowbox__=U[aL.colname];U.__rowbox___count=U[aL.colname+"_count"]}}A.createRow(aL,C,false,U,!C)},A)},onValid:function(aL,A,C,U){var aN=this.findColByName(C);if(aN){var aM=Ext.get([this.id,C,A.id].join(W));if(aM){if(U==y){aM.addClass(ad)}else{aM.removeClass([ap,ad])}}}},isFunctionCol:function(A){return A==P||A==Q},onAdd:function(aV,aP,aR){var aZ=this,aL=aR,aN=aZ.columns,aY=aZ.groups,A=aY.length,aQ=aV.data.length,aS=aZ.parseCss(aZ.renderRow(aP,aR)),aM=((A==aQ?aR:A)%2==0?m:c);s(aY,aP,aN);aZ.removeEmptyRow();var aX=Ext.get(document.createElement(aH)),C=aZ.tbody;aX.set({id:aZ.id+f+aP.id,style:aS.style,_row:aP.id});X(aN,function(a1){if(a1.hidden&&a1.visiable==y){return V}var a2=a1.name,a3=y;if(a1.group){var a0=0;C.select(T+a2+q).each(function(a9,a5){var a8=aZ.dataset.findById(a9.parent(aH).getAttributeNS(m,"_row")),a6=aP.get(a2);if(a8&&!Y(a6)&&a8.get(a2)==a6){var a4=af(aY,a6),a7=an(a4).length;a0+=a7;a9.dom.rowSpan=a7;a3=V;aR=a0-1;aM=a9.parent(aH).hasClass(c)?c:m;if(aY.indexOf(a4)!=-1&&aN[0].type){C.query("td[recordid="+a8.id+"]:first")[0].rowSpan=a7;if(aP!==a8){aX.select("td[recordid="+aP.id+"]:first").remove()}}return y}else{a0+=a9.dom.rowSpan}});if(!a3){aR=aL}}if(a3){return}aZ.createCell(aX.dom,a1,aP)});aX.addClass(aM+i+aS.cls);if(aR===aQ-1){C.appendChild(aX)}else{var aT=function(a1,a0){if(a0<aR){return y}},aU=C.select(F).filter(aT),U=aU.item(0),aO=(U&&aM==(U.hasClass(c)?c:m)),aW=aE(aP);aX.insertBefore(U);aO&&setTimeout(function(){aT=function(a0){if(aE(aV.findById(a0.getAttributeNS(m,"_row")))===aW){return y}};aU.filter(aT).toggleClass(c)},1)}aZ.selectRow(aV.indexOf(aP));aZ.setSelectStatus(aP)},onRemove:function(aL,A,C){var U=this,aM=Ext.get(U.id+f+A.id);if(aM){aM.remove()}am(U.groups,A);X(U.columns,function(aN){var aO=aN.name;if(aN.group){U.tbody.select(T+aO+q).each(function(aR){var aQ=U.dataset.findById(aR.parent(aH).getAttributeNS(m,"_row")),aP;if(aQ&&aQ.get(aO)==A.get(aO)){if((aP=aR.getAttribute("rowspan"))&&(aP-=1)>1){aR.dom.rowSpan=aP}return y}})}});U.selectTr=ah;ak.Masker.unmask(U.wrap);U.drawFootBar()},onMouseDown:function(aM,U){U=(U=Ext.fly(U)).is(a)?U:U.parent(a);var aL=this,C=U.getAttribute("atype"),A;if((A=aL.currentEditor)&&A.editor instanceof ak.CheckBox&&C==aD&&U.getAttribute(I)==A.name){if(aM.shiftKey){aL._begin=A.record;aM.stopEvent()}else{if((U=U.child(".table-ckb"))&&U.dom.className.search(/readonly/)==-1){aM.stopEvent();A.editor.focus.defer(Ext.isIE?1:0,A.editor)}}}},focus:function(){this.wrap.focus()},onFocus:function(){this.hasFocus=V},blur:function(){this.wrap.blur()},onBlur:function(){this.hasFocus=y},clearBody:function(){var A=this.tbody.dom;while(A.childNodes.length){A.removeChild(A.firstChild)}this.emptyRow=ah},getDataIndex:function(U){for(var C=0,aL=this.dataset.data,A=aL.length;C<A;C++){if(aL[C].id==U){return C}}return -1},onEditorBlur:function(aL,C){var U=this,A=U.currentEditor;if(A&&!A.editor.isEventFromComponent(C)){U.hideEditor.defer(Ext.isIE9?10:0,U)}},onMouseWheel:function(C){C.stopEvent();if(this.editing==V){return}var U=C.getWheelDelta(),A=this.dataset;if(U>0){A.pre()}else{if(U<0){A.next()}}},onIndexChange:function(U,C){var A=this.getDataIndex(C.id);if(A==-1){return}this.selectRow(A,y)},onFieldChange:function(aL,A,aM,C,U){if(C==G){var aN=Ext.get([this.id,aM.name,A.id].join(W));if(aN){aN[U==V?"addClass":"removeClass"](ap)}}},onBeforeRemove:function(){ak.Masker.mask(this.wrap,_lang["grid.mask.remove"])},onBeforeLoad:function(){ak.Masker.mask(this.wrap,_lang["grid.mask.loading"])},onAfterSuccess:function(){ak.Masker.unmask(this.wrap)},onBeforSubmit:function(A){ak.Masker.mask(this.wrap,_lang["grid.mask.submit"])},onFetching:function(A){var C=this;C.isFetching=true;ak.Masker.mask(C.wrap,_lang["grid.mask.fetching"]);A.on("fetched",C.onFetched,C)},onFetched:function(A){var C=this;C.isFetching=false;ak.Masker.unmask(C.wrap);A.un("fetched",C.onFetched,C);A.un("fetching",C.onFetching,C)},onAjaxFailed:function(C,A){ak.Masker.unmask(this.wrap)},deleteSelectRows:function(U){var C=this.dataset,A=[].concat(C.getSelected());if(A.length>0){C.remove(A)}},remove:function(){var A=this.dataset.getSelected();if(A.length>0){ak.showConfirm(_lang["grid.remove.confirm"],_lang["grid.remove.confirmMsg"],this.deleteSelectRows.createDelegate(this))}},clear:function(){var C=this.dataset,A=C.getSelected();while(A[0]){C.removeLocal(A[0])}},_export:function(U,C,aL,A){this.exportOptions=Ext.apply({type:"xls",filename:"excel"},arguments.length==1?U:{type:U||"xls",filename:C||"excel",separator:aL,param:A});this.showExportConfirm()},showExportConfirm:function(){var aL=this,aP=0,aO=aL.id+"_export",aN=['<div class="item-export-wrap" style="margin:15px;width:270px" id="',aO,'">','<div class="grid-uh" atype="grid.uh" style="width: 270px; -moz-user-select: none; text-align: left; height: 25px; cursor: default;" onselectstart="return false;" unselectable="on">','<table cellSpacing="0" cellPadding="0" border="0"><tbody><tr height="25px">','<td class="export-hc" style="width:22px;" atype="export.rowcheck"><center><div title="',_lang["grid.export.selectinfo"],'" atype="export.headcheck" class="',aI,ao,'"></div></center></td>','<td class="export-hc" style="width:222px;" atype="grid-type">',_lang["grid.export.column"],"</td>","</tr></tbody></table></div>",'<div style="overflow:auto;height:200px;"><table cellSpacing="0" cellPadding="0" border="0"><tbody>'],U=V,A=370,aM=aL.exportOptions||(aL.exportOptions={}),C=aM&&aM.type;X(aL.columns,function(aR,aQ){if(!aL.isFunctionCol(aR.type)){if(U){U=aR.forexport!==y}aN.push("<tr",(aP+aQ)%2==0?m:' class="',c,'"','><td class="',"grid-rowbox",'" style="width:22px;" ',p,'="',aQ,'" atype="export.rowcheck"><center><div id="',aL.id,e,aQ,'" class="',aI,aR.forexport===y?ao:aw,'"></div></center></td><td style="width:222px"><div class="',"grid-cell",'">',aR.prompt,aR.hidden?['<div style="float:right;color:red">&lt;',_lang["grid.export.hidecolumn"],"&gt;</div>"].join(""):m,"</div></td></tr>")}else{aP++}});if(U){aN[9]=aw}aN.push("</tbody></table></div></div>");if(C=="xls"||C=="xlsx"){A+=30;aN.push('<div class="item-radio" class="item-radio" style="margin:15px;width:270px;height:30px">','<div class="item-radio-option" style="width:128px;float:left" itemvalue="xls">','<div class="item-radio-img  item-radio-img-',C=="xls"?"c":"u",'"></div>','<label class="item-radio-lb">excel2003</label>',"</div>",'<div class="item-radio-option" style="width:128px;float:left" itemvalue="xlsx">','<div class="item-radio-img  item-radio-img-',C=="xlsx"?"c":"u",'"></div>','<label class="item-radio-lb">excel2007</label>',"</div>","</div>")}aN.push('<div style="margin:15px;width:270px;color:red">',_lang["grid.export.confirmMsg"],"</div>");aL.exportwindow=ak.showOkCancelWindow(_lang["grid.export.config"],aN.join(m),function(aQ){aL.doExport();aQ.body.un(h,aL.onExportClick,aL)},ah,380,A);aL.exportwindow.body.on(h,aL.onExportClick,aL)},onExportClick:function(aO,aU){aU=Ext.fly(aU);var aN=this,aQ=aU.parent("td.grid-rowbox")||aU.parent("td.export-hc"),C=aU.hasClass("item-radio-option")?aU:aU.parent("div.item-radio-option");if(aQ){var U=aQ.getAttributeNS(m,ATYPE);if(U=="export.rowcheck"){var aS=aQ.getAttributeNS(m,p),aL=aQ.child(DIV),aR=aL.hasClass(aw),aM=aL.getAttributeNS(m,ATYPE),aP=aN.columns;aN.setCheckBoxStatus(aL,!aR);if(aM=="export.headcheck"){var aT=(aN.isFunctionCol(aP[0].type)?1:0)+(aN.isFunctionCol(aP[1].type)?1:0),A=aO.ctrlKey;aN.exportwindow.body.select("td[atype=export.rowcheck] div[atype!=export.headcheck]").each(function(aV,aX,aW){aX=aP[aW+aT];if(!A||!aX.hidden){aN.setCheckBoxStatus(aV,!aR);aX.forexport=!aR}})}else{aP[aS].forexport=!aR}}}else{if(C){aN.setRadioStatus(C.child("div"),V);aN.setRadioStatus((C.prev()||C.next()).child("div"),y);aN.exportOptions.type=C.getAttributeNS(m,"itemvalue")}}},doExport:function(){var C=this,A=C.exportOptions||{};ak.doExport(C.dataset,C.columns,ah,A.type,A.separator,A.filename,A.param);delete C.exportOptions},destroy:function(){ak.Table.superclass.destroy.call(this);this.processDataSetLiestener("un")}});ak.Table.revision="$Rev$"})($A);